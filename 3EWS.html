<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator EWS: Toggles</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --bg-color: #f4f6f8;
            --border-color: #ddd;
            /* Alert Colors */
            --c-green-bg: #d4edda; --c-green-border: #28a745; --c-green-text: #155724;
            --c-yellow-bg: #fff3cd; --c-yellow-border: #ffc107; --c-yellow-text: #856404;
            --c-red-bg: #f8d7da; --c-red-border: #dc3545; --c-red-text: #721c24;
            --c-blue-bg: #cce5ff; --c-blue-border: #004085; --c-blue-text: #004085;
        }

        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px; /* Reduced padding for mobile */
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        /* --- COLLAPSIBLE STYLING (MOBILE FIX INCLUDED) --- */
        details {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        summary {
            background-color: var(--secondary-color);
            padding: 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            
            /* Text Color Isolation Fix */
            color: #ffffff;
            opacity: 1;
            -webkit-text-fill-color: #ffffff;
            -webkit-opacity: 1;
            filter: none;
        }

        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }

        summary:after {
            content: '+';
            font-size: 18px;
            font-weight: bold;
            color: #ffffff;
            opacity: 1;
            -webkit-text-fill-color: #ffffff;
        }
        details[open] summary:after { content: '-'; }

        .content { padding: 15px; }

        /* --- NEW TOGGLE BUTTON GRID SYSTEM --- */
        .param-section {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .param-label {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: block;
            font-size: 0.95rem;
        }

        .toggle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 6px;
        }

        /* Button Styling */
        .t-btn {
            padding: 10px 4px;
            border: 1px solid #ccc;
            background-color: #fcfcfc;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            font-size: 13px;
            transition: all 0.1s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 50px;
            position: relative;
            user-select: none;
        }

        .t-btn span.val { font-weight: bold; display: block; margin-bottom: 2px; }
        .t-btn span.pts { font-size: 10px; color: #666; }

        /* Selected States by Severity */
        .t-btn.selected {
            transform: scale(0.98);
            box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
            font-weight: bold;
        }

        /* 0 Points (Green) */
        .t-btn[data-score="0"].selected {
            background-color: var(--c-green-bg);
            border-color: var(--c-green-border);
            color: var(--c-green-text);
        }
        .t-btn[data-score="0"].selected span.pts { color: var(--c-green-text); }

        /* 1-2 Points (Yellow/Orange) */
        .t-btn[data-score="1"].selected, 
        .t-btn[data-score="2"].selected {
            background-color: var(--c-yellow-bg);
            border-color: var(--c-yellow-border);
            color: var(--c-yellow-text);
        }
        .t-btn[data-score="1"].selected span.pts,
        .t-btn[data-score="2"].selected span.pts { color: var(--c-yellow-text); }

        /* 3 Points (Red) */
        .t-btn[data-score="3"].selected {
            background-color: var(--c-red-bg);
            border-color: var(--c-red-border);
            color: var(--c-red-text);
        }
        .t-btn[data-score="3"].selected span.pts { color: var(--c-red-text); }

        /* Blue Criteria */
        .t-btn[data-blue="true"].selected {
            background-color: var(--c-blue-bg);
            border-color: var(--c-blue-border);
            color: var(--c-blue-text);
        }
        .t-btn[data-blue="true"].selected span.pts { color: var(--c-blue-text); }

        /* --- RESULT BOX --- */
        .result-bar {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 15px;
            border-top: 2px solid #ddd;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            text-align: center;
            font-weight: bold;
            display: none; /* Hidden until calculated */
            z-index: 100;
        }

        .status-normal { background-color: var(--c-green-bg); color: var(--c-green-text); border: 1px solid var(--c-green-border); }
        .status-warning { background-color: var(--c-yellow-bg); color: var(--c-yellow-text); border: 1px solid var(--c-yellow-border); }
        .status-danger { background-color: var(--c-red-bg); color: var(--c-red-text); border: 1px solid var(--c-red-border); }
        .status-blue { background-color: var(--c-blue-bg); color: var(--c-blue-text); border: 1px solid var(--c-blue-border); }

        .ref-table { width: 100%; border-collapse: collapse; font-size: 11px; margin-top: 5px; }
        .ref-table th, .ref-table td { border: 1px solid #ccc; padding: 4px; text-align: center; }
        .ref-table th { background: #eee; }

    </style>
</head>
<body>

<h1>Kalkulator EWS Touch</h1>

<details id="details-dewasa">
    <summary>EWS Dewasa</summary>
    <div class="content">
        
        <div class="param-section" id="grp-d-arrest">
            <label class="param-label">Henti Jantung?</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'arrest', 0, false, this)">
                    <span class="val">Tidak</span><span class="pts">Lanjut</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'arrest', 0, true, this)" data-blue="true">
                    <span class="val">Ya</span><span class="pts">Code Blue</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-d-avpu">
            <label class="param-label">Kesadaran (AVPU)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'avpu', 0, false, this)" data-score="0">
                    <span class="val">Sadar Penuh</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'avpu', 3, false, this)" data-score="3">
                    <span class="val">V / P</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'avpu', 0, true, this)" data-blue="true">
                    <span class="val">Unresponsive</span><span class="pts">Blue</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-d-bp">
            <label class="param-label">Tekanan Darah Sistolik (mmHg)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'bp', 0, true, this)" data-blue="true">
                    <span class="val">&lt; 70</span><span class="pts">Blue</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'bp', 3, false, this)" data-score="3">
                    <span class="val">71-90</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'bp', 2, false, this)" data-score="2">
                    <span class="val">91-100</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'bp', 1, false, this)" data-score="1">
                    <span class="val">101-110</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'bp', 0, false, this)" data-score="0">
                    <span class="val">111-180</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'bp', 1, false, this)" data-score="1">
                    <span class="val">181-220</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'bp', 3, false, this)" data-score="3">
                    <span class="val">&gt; 221</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-d-hr">
            <label class="param-label">Laju Jantung (x/menit)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'hr', 0, true, this)" data-blue="true">
                    <span class="val">&lt;40 / &gt;140</span><span class="pts">Blue</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'hr', 1, false, this)" data-score="1">
                    <span class="val">41-50</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'hr', 0, false, this)" data-score="0">
                    <span class="val">51-90</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'hr', 1, false, this)" data-score="1">
                    <span class="val">91-110</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'hr', 2, false, this)" data-score="2">
                    <span class="val">111-130</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'hr', 3, false, this)" data-score="3">
                    <span class="val">131-140</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-d-rr">
            <label class="param-label">Laju Respirasi (x/menit)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'rr', 0, true, this)" data-blue="true">
                    <span class="val">&lt;5 / &gt;35</span><span class="pts">Blue</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'rr', 3, false, this)" data-score="3">
                    <span class="val">6-8</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'rr', 1, false, this)" data-score="1">
                    <span class="val">9-11</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'rr', 0, false, this)" data-score="0">
                    <span class="val">12-20</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'rr', 2, false, this)" data-score="2">
                    <span class="val">21-24</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'rr', 3, false, this)" data-score="3">
                    <span class="val">25-34</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-d-temp">
            <label class="param-label">Temperatur (°C)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'temp', 3, false, this)" data-score="3">
                    <span class="val">&lt; 35</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'temp', 1, false, this)" data-score="1">
                    <span class="val">35.1-36</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'temp', 0, false, this)" data-score="0">
                    <span class="val">36.1-38</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'temp', 1, false, this)" data-score="1">
                    <span class="val">38.1-39</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'temp', 2, false, this)" data-score="2">
                    <span class="val">&gt; 39</span><span class="pts">2</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-d-sat">
            <label class="param-label">Saturasi O2 (%)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'sat', 3, false, this)" data-score="3">
                    <span class="val">&lt; 91</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'sat', 2, false, this)" data-score="2">
                    <span class="val">92-93</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'sat', 1, false, this)" data-score="1">
                    <span class="val">94-95</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'sat', 0, false, this)" data-score="0">
                    <span class="val">&gt; 95</span><span class="pts">0</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-d-o2">
            <label class="param-label">Suplemen Oksigen</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('d', 'o2', 0, false, this)" data-score="0">
                    <span class="val">Tidak</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('d', 'o2', 2, false, this)" data-score="2">
                    <span class="val">Ya</span><span class="pts">2</span>
                </div>
            </div>
        </div>

    </div>
</details>

<details id="details-obstetri">
    <summary>EWS Obstetri</summary>
    <div class="content">

        <div class="param-section" id="grp-o-arrest">
            <label class="param-label">Henti Jantung</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('o', 'arrest', 0, false, this)">
                    <span class="val">Tidak</span><span class="pts">Lanjut</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'arrest', 0, true, this)" data-blue="true">
                    <span class="val">Ya</span><span class="pts">Resusitasi</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-o-hr">
            <label class="param-label">Laju Jantung (x/m)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('o', 'hr', 3, false, this)" data-score="3">
                    <span class="val">&lt; 50</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'hr', 2, false, this)" data-score="2">
                    <span class="val">50-60</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'hr', 0, false, this)" data-score="0">
                    <span class="val">61-100</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'hr', 1, false, this)" data-score="1">
                    <span class="val">101-110</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'hr', 2, false, this)" data-score="2">
                    <span class="val">111-120</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'hr', 3, false, this)" data-score="3">
                    <span class="val">&gt; 120</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-o-sys">
            <label class="param-label">Tekanan Darah Sistole (mmHg)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('o', 'sys', 3, false, this)" data-score="3">
                    <span class="val">&lt; 90</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'sys', 0, false, this)" data-score="0">
                    <span class="val">90-140</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'sys', 1, false, this)" data-score="1">
                    <span class="val">141-150</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'sys', 2, false, this)" data-score="2">
                    <span class="val">151-160</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'sys', 3, false, this)" data-score="3">
                    <span class="val">&gt; 160</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-o-dia">
            <label class="param-label">Tekanan Darah Diastole (mmHg)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('o', 'dia', 0, false, this)" data-score="0">
                    <span class="val">60-90</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'dia', 1, false, this)" data-score="1">
                    <span class="val">91-100</span><span class="pts">1</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'dia', 2, false, this)" data-score="2">
                    <span class="val">101-110</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'dia', 3, false, this)" data-score="3">
                    <span class="val">&gt; 110</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-o-rr">
            <label class="param-label">Laju Respirasi (x/m)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('o', 'rr', 3, false, this)" data-score="3">
                    <span class="val">&lt; 12</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'rr', 0, false, this)" data-score="0">
                    <span class="val">12-20</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'rr', 2, false, this)" data-score="2">
                    <span class="val">21-25</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'rr', 3, false, this)" data-score="3">
                    <span class="val">&gt; 25</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-o-temp">
            <label class="param-label">Suhu Tubuh (°C)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('o', 'temp', 3, false, this)" data-score="3">
                    <span class="val">&lt; 36</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'temp', 0, false, this)" data-score="0">
                    <span class="val">36.1-37.2</span><span class="pts">0</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'temp', 2, false, this)" data-score="2">
                    <span class="val">37.3-37.7</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'temp', 3, false, this)" data-score="3">
                    <span class="val">&gt; 37.7</span><span class="pts">3</span>
                </div>
            </div>
        </div>

        <div class="param-section" id="grp-o-sat">
            <label class="param-label">Saturasi Oksigen (%)</label>
            <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('o', 'sat', 3, false, this)" data-score="3">
                    <span class="val">&lt; 92</span><span class="pts">3</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'sat', 2, false, this)" data-score="2">
                    <span class="val">92-95</span><span class="pts">2</span>
                </div>
                <div class="t-btn" onclick="setScore('o', 'sat', 0, false, this)" data-score="0">
                    <span class="val">&gt; 95</span><span class="pts">0</span>
                </div>
            </div>
        </div>

        <div class="param-section">
            <label class="param-label">Parameter Tambahan</label>
            <div style="font-size:12px; margin-bottom:4px; font-weight:bold;">Kesadaran</div>
            <div class="toggle-grid" id="grp-o-avpu" style="margin-bottom:10px;">
                <div class="t-btn" onclick="setScore('o', 'avpu', 0, false, this)" data-score="0"><span class="val">A (Alert)</span></div>
                <div class="t-btn" onclick="setScore('o', 'avpu', 3, false, this)" data-score="3"><span class="val">V, P, U</span></div>
            </div>

            <div style="font-size:12px; margin-bottom:4px; font-weight:bold;">Nyeri selain persalinan</div>
            <div class="toggle-grid" id="grp-o-pain" style="margin-bottom:10px;">
                <div class="t-btn" onclick="setScore('o', 'pain', 0, false, this)" data-score="0"><span class="val">Normal</span></div>
                <div class="t-btn" onclick="setScore('o', 'pain', 3, false, this)" data-score="3"><span class="val">Abnormal</span></div>
            </div>

            <div style="font-size:12px; margin-bottom:4px; font-weight:bold;">Discharge / Lokia</div>
            <div class="toggle-grid" id="grp-o-lochia" style="margin-bottom:10px;">
                <div class="t-btn" onclick="setScore('o', 'lochia', 0, false, this)" data-score="0"><span class="val">Normal</span></div>
                <div class="t-btn" onclick="setScore('o', 'lochia', 3, false, this)" data-score="3"><span class="val">Abnormal</span></div>
            </div>

            <div style="font-size:12px; margin-bottom:4px; font-weight:bold;">Proteinuria</div>
            <div class="toggle-grid" id="grp-o-prot" style="margin-bottom:10px;">
                <div class="t-btn" onclick="setScore('o', 'prot', 0, false, this)" data-score="0"><span class="val">Neg / +</span></div>
                <div class="t-btn" onclick="setScore('o', 'prot', 2, false, this)" data-score="2"><span class="val">++</span></div>
                <div class="t-btn" onclick="setScore('o', 'prot', 3, false, this)" data-score="3"><span class="val">&gt; ++</span></div>
            </div>

             <div style="font-size:12px; margin-bottom:4px; font-weight:bold;">Oksigen Tambahan</div>
            <div class="toggle-grid" id="grp-o-o2">
                <div class="t-btn" onclick="setScore('o', 'o2', 0, false, this)" data-score="0"><span class="val">Tidak</span></div>
                <div class="t-btn" onclick="setScore('o', 'o2', 2, false, this)" data-score="2"><span class="val">Ya</span></div>
            </div>
        </div>

    </div>
</details>

<details id="details-pediatrik">
    <summary>EWS Pediatrik</summary>
    <div class="content">

        <div class="param-section">
            <details>
                <summary style="background-color: #ecf0f1; color: #333; -webkit-text-fill-color: #333; font-size: 12px; padding: 8px;">Tabel Referensi Nadi & Napas Normal</summary>
                <table class="ref-table">
                    <tr><th>Usia</th><th>Nadi</th><th>Napas</th></tr>
                    <tr><td>0-1 bln</td><td>100-180</td><td>40-60</td></tr>
                    <tr><td>1-12 bln</td><td>100-180</td><td>35-40</td></tr>
                    <tr><td>1-3 thn</td><td>70-110</td><td>25-30</td></tr>
                    <tr><td>4-6 thn</td><td>70-110</td><td>21-23</td></tr>
                    <tr><td>7-12 thn</td><td>70-110</td><td>19-21</td></tr>
                    <tr><td>13-19 thn</td><td>55-90</td><td>16-18</td></tr>
                </table>
            </details>
        </div>

        <div class="param-section" id="grp-p-arrest">
             <label class="param-label">Henti Jantung</label>
             <div class="toggle-grid">
                <div class="t-btn" onclick="setScore('p', 'arrest', 0, false, this)"><span class="val">Tidak</span></div>
                <div class="t-btn" onclick="setScore('p', 'arrest', 0, true, this)" data-blue="true"><span class="val">Ya (Gawat)</span></div>
             </div>
        </div>

        <div class="param-section" id="grp-p-resp">
            <label class="param-label">Sistem Respirasi</label>
            <div class="toggle-grid" style="grid-template-columns: 1fr;">
               <div class="t-btn" onclick="setScore('p', 'resp', 0, false, this)" data-score="0">
                   <span class="val">Normal</span>
                   <span class="pts">Tidak retraksi, napas normal</span>
               </div>
               <div class="t-btn" onclick="setScore('p', 'resp', 1, false, this)" data-score="1">
                   <span class="val">Ringan</span>
                   <span class="pts">Takipnea >10x, otot bantu, FiO2 >30%</span>
               </div>
               <div class="t-btn" onclick="setScore('p', 'resp', 2, false, this)" data-score="2">
                   <span class="val">Sedang</span>
                   <span class="pts">Takipnea >20x, retraksi, FiO2 >40%</span>
               </div>
               <div class="t-btn" onclick="setScore('p', 'resp', 3, false, this)" data-score="3">
                   <span class="val">Berat</span>
                   <span class="pts">Bradipnea, retraksi berat, merintih, FiO2 >50%</span>
               </div>
            </div>
       </div>

       <div class="param-section" id="grp-p-gen">
            <label class="param-label">Keadaan Umum</label>
            <div class="toggle-grid" style="grid-template-columns: 1fr;">
                <div class="t-btn" onclick="setScore('p', 'gen', 0, false, this)" data-score="0">
                    <span class="val">Biasa</span>
                    <span class="pts">Berinteraksi seperti biasa</span>
                </div>
                <div class="t-btn" onclick="setScore('p', 'gen', 1, false, this)" data-score="1">
                    <span class="val">Somnolen</span>
                    <span class="pts">Dapat ditenangkan</span>
                </div>
                <div class="t-btn" onclick="setScore('p', 'gen', 2, false, this)" data-score="2">
                    <span class="val">Iritable</span>
                </div>
                <div class="t-btn" onclick="setScore('p', 'gen', 3, false, this)" data-score="3">
                    <span class="val">Letargi</span>
                    <span class="pts">Gelisah / Penurunan respon</span>
                </div>
            </div>
       </div>

       <div class="param-section" id="grp-p-card">
            <label class="param-label">Sistem Kardiovaskuler</label>
            <div class="toggle-grid" style="grid-template-columns: 1fr;">
                <div class="t-btn" onclick="setScore('p', 'card', 0, false, this)" data-score="0">
                    <span class="val">Normal</span>
                    <span class="pts">Tidak sianosis, CRT &lt; 2s</span>
                </div>
                <div class="t-btn" onclick="setScore('p', 'card', 1, false, this)" data-score="1">
                    <span class="val">Pucat</span>
                    <span class="pts">CRT 2s</span>
                </div>
                <div class="t-btn" onclick="setScore('p', 'card', 2, false, this)" data-score="2">
                    <span class="val">Sianosis / Takikardi</span>
                    <span class="pts">CRT &gt; 2s / HR &gt;20x normal</span>
                </div>
                <div class="t-btn" onclick="setScore('p', 'card', 3, false, this)" data-score="3">
                    <span class="val">Sianotik / Motling</span>
                    <span class="pts">CRT &gt; 5s / HR &gt;30x normal / Bradi</span>
                </div>
            </div>
       </div>

    </div>
</details>

<div id="result-bar" class="result-bar">
    Pilih parameter untuk melihat hasil
</div>

<div style="margin-top: 50px; text-align: center; font-size: 11px; color: #777;">
    Sumber: Kementerian Kesehatan Republik Indonesia - RSUP Dr. Sardjito Yogyakarta 2017
</div>

<script>
    // State Management
    const scores = {
        d: { arrest:0, avpu:0, bp:0, hr:0, rr:0, temp:0, sat:0, o2:0 },
        o: { arrest:0, avpu:0, hr:0, sys:0, dia:0, rr:0, temp:0, sat:0, o2:0, pain:0, lochia:0, prot:0 },
        p: { arrest:0, resp:0, gen:0, card:0 }
    };

    const blueFlags = {
        d: { arrest:false, avpu:false, bp:false, hr:false, rr:false },
        o: { arrest:false },
        p: { arrest:false }
    };

    let activeType = null; // 'd', 'o', or 'p'

    function setScore(type, param, score, isBlue, btn) {
        // Set active type for calculation
        activeType = type;

        // 1. Visual update (Radio Button behavior)
        const parent = btn.parentElement;
        const buttons = parent.getElementsByClassName('t-btn');
        for (let b of buttons) {
            b.classList.remove('selected');
        }
        btn.classList.add('selected');

        // 2. Data Update
        scores[type][param] = score;
        if (blueFlags[type].hasOwnProperty(param)) {
            blueFlags[type][param] = isBlue;
        }

        // 3. Trigger Calculation
        calculate();
    }

    function calculate() {
        if (!activeType) return;
        
        let total = 0;
        let isCodeBlue = false;
        let resultText = "";
        let resultClass = "";

        // Determine which calculation to run based on last interaction
        if (activeType === 'd') { // DEWASA
            // Sum scores
            for (let k in scores.d) total += scores.d[k];
            // Check Blue
            for (let k in blueFlags.d) {
                if (blueFlags.d[k]) isCodeBlue = true;
            }

            if (isCodeBlue) {
                resultText = "CODE BLUE - AKTIFKAN TIM MEDIS";
                resultClass = "status-blue";
            } else {
                resultText = `EWS Dewasa: ${total}`;
                if (total >= 5) resultClass = "status-danger";
                else if (total >= 1) resultClass = "status-warning";
                else resultClass = "status-normal";
            }

        } else if (activeType === 'o') { // OBSTETRI
            for (let k in scores.o) total += scores.o[k];
            if (blueFlags.o.arrest) isCodeBlue = true;

            if (isCodeBlue) {
                resultText = "HENTI JANTUNG - RESUSITASI SEGERA";
                resultClass = "status-blue";
            } else {
                // Obstetri Logic: >=5 OR any param==3 (simplified check on total score often used, but strict logic requires checking individual 3s)
                let hasThree = false;
                for(let k in scores.o) { if(scores.o[k] === 3) hasThree = true; }

                if (total >= 5 || hasThree) {
                    resultText = `Skor ${total} - Respons Klinis Segera`;
                    resultClass = "status-danger";
                } else if (total >= 3) {
                    resultText = `Skor ${total} - Evaluasi Ulang`;
                    resultClass = "status-warning";
                } else {
                    resultText = `Skor ${total} - Observasi Rutin`;
                    resultClass = "status-normal";
                }
            }

        } else if (activeType === 'p') { // PEDIATRIK
            for (let k in scores.p) total += scores.p[k];
            if (blueFlags.p.arrest) isCodeBlue = true;

            if (isCodeBlue) {
                resultText = "KEADAAN GAWAT DARURAT";
                resultClass = "status-blue";
            } else {
                resultText = `EWS Anak: ${total}`;
                if (total >= 5) resultClass = "status-danger"; // General threshold
                else if (total >= 1) resultClass = "status-warning";
                else resultClass = "status-normal";
            }
        }

        // Display
        const resBar = document.getElementById('result-bar');
        resBar.style.display = 'block';
        resBar.className = 'result-bar ' + resultClass;
        resBar.innerHTML = resultText;
    }

    // Auto-collapse logic to ensure only one EWS type is open at a time (optional UX improvement)
    const detailsElements = document.querySelectorAll('details');
    detailsElements.forEach((detail) => {
        detail.addEventListener('toggle', (e) => {
            if (detail.open) {
                // Identify type
                if(detail.id.includes('dewasa')) activeType = 'd';
                else if(detail.id.includes('obstetri')) activeType = 'o';
                else if(detail.id.includes('pediatrik')) activeType = 'p';
                
                // Close others
                detailsElements.forEach((other) => {
                    if (other !== detail && other.open && !other.parentElement.classList.contains('param-section')) { // exclude nested details
                        other.open = false;
                    }
                });
                // Reset result bar when switching tables
                document.getElementById('result-bar').style.display = 'none';
            }
        });
    });

</script>

</body>
</html>
